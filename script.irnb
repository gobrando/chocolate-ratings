{"cells":[{"metadata":{"_uuid":"dce64879ee3e741af59dcdcd4a20f473b4cd2195"},"cell_type":"markdown","source":"<h1> Using R to Plot Insight About Chocolate Reviewers Preference Over Time :D "},{"metadata":{"_uuid":"a21abed1aaddcbde1a257630e39ee49b84d07817","_cell_guid":"a395a9f0-372a-4419-a992-45a3c3e0bc0f"},"cell_type":"markdown","source":"## Load in and clean our data"},{"metadata":{"_uuid":"79afe21fc8fe7dfc42cf19e991e0de30c2c7d327","trusted":true,"_cell_guid":"9c534969-453f-4e78-b545-d06600e1fd94"},"cell_type":"code","source":"# tell R that we're going to use the tidyverse library\nlibrary(tidyverse)\n\n# read in our dataset as a data_frame and save it as a variable named \"chocolateData\"\nchocolateData <- read_csv('../input/flavors_of_cacao.csv')\n\n# remove the first line of our dataset using a negative index\nchocolateData <- chocolateData[-1,]\n\n# remove the white spaces in the column names\nnames(chocolateData) <- gsub(\"[[:space:]+]\", \"_\", names(chocolateData))\n\n# remove percentage signs in the Cocoa_Percent \nchocolateData$Cocoa_Percent <- sapply(chocolateData$Cocoa_Percent, function(x) gsub(\"%\", \"\", x))\n\n# fix the data type of each column using type_convert\nchocolateData <- type_convert(chocolateData)\n# check the first few lines of our data_frame to make sure everything looks alright.\nhead(chocolateData)","execution_count":30,"outputs":[]},{"metadata":{"_uuid":"31ac82abc6fd57c665481c290bdfda0c0423a634","_cell_guid":"ad4caa61-1a11-44bb-97de-fce339dbefc6"},"cell_type":"markdown","source":"## Graph Average Review Rating Over Time"},{"metadata":{"_uuid":"990a9842e178c2cab2529ab15ff8e6dc00fab039","trusted":true,"_cell_guid":"8e55a3fe-3759-4976-8e69-2f1ff03e3709"},"cell_type":"code","source":"# draw a plot with \"Review_Date\" as the x axis and \"Rating\" as the y axis, add a point for each data point & move each point slightly so they don't overlap\nggplot(chocolateData, aes(x= Review_Date, y = Rating)) + geom_point() + geom_jitter()","execution_count":33,"outputs":[]},{"metadata":{"scrolled":true,"_uuid":"c0ec2d1d886043b9fd20ea5b3fd87ee9700ad5e8","trusted":true,"_cell_guid":"27e49ca8-e53b-42f6-9615-4cab7c0f8615"},"cell_type":"code","source":"# draw a plot with \"Review_Date\" as the x axis and \"Rating\" as the y axis, add a point for each data point, move each point slightly so they don't overlap and add a smoothed line (lm = linear model)\nggplot(chocolateData, aes(x= Review_Date, y = Rating)) + \n    geom_point() + \n    geom_jitter() +\n    geom_smooth(method = 'lm')","execution_count":34,"outputs":[]},{"metadata":{"_uuid":"5f9909872bc50c1d8483fe3aae344d3f533d7629","trusted":true,"_cell_guid":"81616f83-eaec-44ea-8e2a-c136cf95643a"},"cell_type":"code","source":"# draw a plot with \"Review_Date\" as the x axis and \"Rating\" as the y axis, add a point for each data point, move each point slightly so they don't overlap and add a smoothed line (lm = linear model). Encode Cocoa_Percent as color.\nggplot(chocolateData, aes(x= Review_Date, y = Rating, color = Cocoa_Percent)) + \n    geom_point() + \n    geom_jitter() +\n    geom_smooth(method = 'lm')","execution_count":35,"outputs":[]},{"metadata":{"_uuid":"e1dcf0da3468c2a7901496bd68aba0ba2bdcf12f","_cell_guid":"2108dd6e-61d1-429f-9c70-209e36de0adc"},"cell_type":"markdown","source":"It looks like chocolate bars with very high cocoa percents tend to get lower ratings. Let's see if that's the case by drawing a helpful graph. "},{"metadata":{"_uuid":"4ab98fa4f33da0042b9ac020e0a4c7423d85fd0c","trusted":true,"_cell_guid":"0907ef6f-1b62-4e6b-b25e-51cbf57e480b"},"cell_type":"code","source":"# Plot the relationship between cocoa percentage and ratings, using loess (more accurate than linear model)\nchocolateRatingByCocoaPercent <- ggplot(chocolateData, aes(x=Cocoa_Percent, y=Rating, color=Cocoa_Percent)) +\n    geom_point() + \n    geom_jitter() +\n    geom_smooth(method='loess')","execution_count":36,"outputs":[]},{"metadata":{"_uuid":"e9b65243d1d54db5c89188c91b77b362100bada4","_cell_guid":"4226fcc6-4596-4dd0-a253-d6341df76375"},"cell_type":"markdown","source":"## Reviews Have Risen Over Time! (Save That Graph!)"},{"metadata":{"_uuid":"769fb1938ad49f1a76c24c2962a9fb8e506c6197","trusted":true,"_cell_guid":"e52c3476-fec0-4da5-83c4-08be84c45cf4"},"cell_type":"code","source":"# save our plot to a variable with an informative name\nchocolateRatingByReviewDate <- ggplot(chocolateData, aes(x= Review_Date, y = Rating, color = Cocoa_Percent)) + \n    geom_point() + \n    geom_jitter() +\n    geom_smooth(method = 'lm')\n\n# save our plot\nggsave(\"chocolateRatingByReviewDate.png\", # the name of the file where it will be save\n       plot = chocolateRatingByReviewDate, # what plot to save\n       height=6, width=10, units=\"in\") # the size of the plot & units of the size","execution_count":18,"outputs":[]},{"metadata":{"_uuid":"3b3b8bf6536dd1d9e6852542da378fdc5959d772","trusted":true,"_cell_guid":"a6ad72e4-8b9c-4dca-8d21-4acb72494b5c"},"cell_type":"code","source":"# Save the plot showing the relationship between cocoa percentage and rating to this kernel's output. \nggsave(\"chocolateRatingByCocoaPercent.png\",\n      chocolateRatingByCocoaPercent, \n      height=6, width=10, units=\"in\")","execution_count":12,"outputs":[]},{"metadata":{"collapsed":true,"_uuid":"cba906bbccf74786ce396f97d5a48b6b3f571f1a","trusted":true,"_cell_guid":"1356d47e-bd86-4f15-ac53-8378e936880e"},"cell_type":"code","source":"# Return the average and sd of ratings by the year a rating was given\nchocolateData %>%\n    group_by(Review_Date) %>%\n    summarise(averageRating = mean(Rating),\n             sdRating = sd(Rating))","execution_count":null,"outputs":[]},{"metadata":{"_uuid":"130f3672def6c12ef806b2fc7aeb681e819320ab","trusted":true,"_cell_guid":"535ee61e-d067-4a93-b50b-72755f4f6946"},"cell_type":"code","source":"# Return the average of ratings by the year a rating was given\naverageRatingByYear <- chocolateData %>%\n    group_by(Review_Date) %>%\n    summarise(averageRating = mean(Rating))\n\n# plot only the average rating by year\naverageRatingByYearPlot <- ggplot(averageRatingByYear, aes(y= averageRating, x = Review_Date )) + \n    geom_point() + # plot individual points\n    geom_line() # plot line\n\nggsave(\"averageRatingByYearPlot.png\",\n      averageRatingByYearPlot, \n      height = 6, width = 10, units = \"in\")","execution_count":13,"outputs":[]},{"metadata":{"_uuid":"c4493985af9477d38024615581e5e5248e398369"},"cell_type":"markdown","source":"## Graph Cocoa Percent Over Time and Save"},{"metadata":{"scrolled":true,"_uuid":"dc5d31d085e8b2aff7f69c78ab1e64af35f13bb7","trusted":true,"_cell_guid":"9826b3c9-6900-4ac9-9d52-7cc338d53298"},"cell_type":"code","source":"# Make & save a data_frame with the average and sd Cocoa_Percent by the year the reviews were written\naveragePercentByYear <- chocolateData %>%\n    group_by(Review_Date) %>%\n        summarise(averagePercent = mean(Cocoa_Percent), \n                 sdPercent = sd(Cocoa_Percent))\n\n# Spot check the variable\nhead(averagePercentByYear)","execution_count":46,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"ebeffa4d2900cbb3a0417cbf266c51b8b0a745af"},"cell_type":"code","source":"# Plot the data_frame \naveragePercentByYearPlot <- ggplot(averagePercentByYear, aes(x=Review_Date, y=averagePercent, color=sdPercent)) +\n    geom_point() +\n    geom_line() +\n    geom_smooth(method = \"lm\") +\n    labs(title = \"Change in Avg Cocoa Percent and SD Over Time\")\n\n# Make sure the graph says something useful \n# Redundent code, yes, but gotta make sure our graph is good. Can remove for production\nggplot(averagePercentByYear, aes(x=Review_Date, y=averagePercent, color=sdPercent)) +\n    geom_point() +\n    geom_line() +\n    geom_smooth(method = \"lm\") +\n    labs(title = \"Change in Avg Cocoa Percent and SD Over Time\")\n\n# Save plot to output\nggsave(\"averagePercentByYearPlot.png\", \n      averagePercentByYearPlot, \n      height = 6, width = 10, units = \"in\")","execution_count":48,"outputs":[]},{"metadata":{"trusted":true,"_uuid":"c453184e2a8781795d6245296f8036f60d3354c0"},"cell_type":"code","source":"ggplot(chocolateData, aes(x = Cocoa_Percent, y = Rating)) + \n    geom_point() + \n    geom_jitter() +\n    geom_smooth(method = \"loess\") + \n    ggtitle(\"Cocoa Percent Reviewer Preference\")","execution_count":56,"outputs":[]},{"metadata":{"_uuid":"46dc83d917be72791879c953e675df713d0c9789"},"cell_type":"markdown","source":"## Conclusion\nIn the last 10 years of chocolate reviews, the average chocolate rating has risen over time with the average range in ratings  decreasing. Why is that? Our graphs of \"Cocoa Percent Reviewer Preference\" and \"Change in Avg Cocoa Percent and SD Over Time\"  tell one possible story which is that chocolate makers have responded to higher ratings for chocolate percent in the mid-70s by making fewer chocolate that is far above or below that percent. Thus more chocolate is being produced that falls in the mid-70s cocoa percentage and reviewers are rewarding them with higher ratings. \n\nInteresting! I prefer my chocolate as dark as possible, but I've known I'm in the minority here"}],"metadata":{"kernelspec":{"display_name":"R","language":"R","name":"ir"},"language_info":{"mimetype":"text/x-r-source","name":"R","pygments_lexer":"r","version":"3.4.2","file_extension":".r","codemirror_mode":"r"}},"nbformat":4,"nbformat_minor":1}